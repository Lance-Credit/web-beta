<template>
    <div class="bg-[#FAFAFA] px-6 md:px-20">
        <div class="h-[72px] flex justify-between pt-[63px] md:pt-8 pb-9 md:pb-5">
            <svg width="132" height="20" viewBox="0 0 132 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.62887 10.258L8.35184 0.199919C8.64416 -0.119605 9.01654 -0.0484924 9.18225 0.358706L11.0078 4.83984C11.0856 5.06046 11.1052 5.29895 11.0644 5.53022C11.0236 5.76148 10.924 5.97695 10.776 6.15398L7.22943 11.5546H2.33732C1.38683 11.5654 0.819885 11.1854 1.62887 10.258Z" fill="black"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M14.4771 18.0004H3.29091C2.62529 17.9565 2.00714 17.7744 1.72227 17.0739L0 12.0034C0.215979 12.36 0.629317 12.7126 1.7511 12.7107H12.6655C12.8902 12.7223 13.1079 12.797 13.2956 12.9269C13.4833 13.0569 13.6341 13.2372 13.7323 13.4491L14.9426 17.2649C15.1092 17.6701 14.9007 18.0013 14.4771 18.0004Z" fill="black"/>
                <path d="M23.3513 12.0379C23.3513 12.2495 23.5228 12.4211 23.7344 12.4211H27.3581C27.5697 12.4211 27.7412 12.5926 27.7412 12.8042V14.4695C27.7412 14.6811 27.5697 14.8526 27.3581 14.8526H20.3832C20.1715 14.8526 20 14.6811 20 14.4695V2.30422C20 2.0926 20.1715 1.92105 20.3832 1.92105H22.9681C23.1797 1.92105 23.3513 2.0926 23.3513 2.30422V12.0379Z" fill="black"/>
                <path d="M28.0854 9.69474C28.0854 8.6386 28.2945 7.7114 28.7125 6.91316C29.1437 6.11491 29.7251 5.50088 30.4568 5.07105C31.1884 4.64123 32.005 4.42631 32.9065 4.42631C33.6774 4.42631 34.3502 4.57368 34.9251 4.86842C35.1369 4.9746 35.3309 5.09273 35.5071 5.22281C35.7744 5.42013 36.2774 5.2402 36.2774 4.90799C36.2774 4.72336 36.4271 4.57368 36.6117 4.57368H39.2455C39.4571 4.57368 39.6287 4.74523 39.6287 4.95685V14.4695C39.6287 14.6811 39.4571 14.8526 39.2455 14.8526H36.6205C36.431 14.8526 36.2774 14.699 36.2774 14.5095C36.2774 14.1719 35.7778 13.9907 35.5064 14.1915C35.3241 14.3263 35.1238 14.4485 34.9055 14.5579C34.3307 14.8526 33.6578 15 32.8869 15C31.9985 15 31.1884 14.7851 30.4568 14.3553C29.7251 13.9132 29.1437 13.293 28.7125 12.4947C28.2945 11.6842 28.0854 10.7509 28.0854 9.69474ZM36.2774 9.71316C36.2774 8.92719 36.0422 8.30702 35.5719 7.85263C35.1146 7.39825 34.5528 7.17105 33.8864 7.17105C33.2201 7.17105 32.6518 7.39825 32.1814 7.85263C31.7241 8.29474 31.4955 8.90877 31.4955 9.69474C31.4955 10.4807 31.7241 11.107 32.1814 11.5737C32.6518 12.0281 33.2201 12.2553 33.8864 12.2553C34.5528 12.2553 35.1146 12.0281 35.5719 11.5737C36.0422 11.1193 36.2774 10.4991 36.2774 9.71316Z" fill="black"/>
                <path d="M48.1285 4.46316C49.4089 4.46316 50.428 4.85614 51.1858 5.64211C51.9567 6.41579 52.3421 7.48421 52.3421 8.84737V14.4695C52.3421 14.6811 52.1706 14.8526 51.9589 14.8526H49.3936C49.182 14.8526 49.0104 14.6811 49.0104 14.4695V9.27105C49.0104 8.58333 48.821 8.04912 48.4421 7.66842C48.0632 7.28772 47.5537 7.09737 46.9135 7.09737C46.2733 7.09737 45.7637 7.28772 45.3848 7.66842C45.0059 8.04912 44.8165 8.58333 44.8165 9.27105V14.4695C44.8165 14.6811 44.6449 14.8526 44.4333 14.8526H41.8484C41.6367 14.8526 41.4652 14.6811 41.4652 14.4695V4.95685C41.4652 4.74523 41.6367 4.57368 41.8484 4.57368H44.4763C44.6642 4.57368 44.8165 4.72597 44.8165 4.91382C44.8165 5.24096 45.2815 5.41719 45.5492 5.22907C45.743 5.09282 45.9561 4.9726 46.1883 4.86842C46.7632 4.59825 47.4099 4.46316 48.1285 4.46316Z" fill="black"/>
                <path d="M53.4166 9.71316C53.4166 8.64474 53.6453 7.7114 54.1026 6.91316C54.5729 6.11491 55.2197 5.50088 56.0428 5.07105C56.879 4.64123 57.8327 4.42631 58.9041 4.42631C60.2759 4.42631 61.4192 4.76403 62.3337 5.43947C63.1406 6.02695 63.7053 6.82347 64.0278 7.82901C64.1032 8.06412 63.9201 8.29474 63.6732 8.29474H60.8532C60.6944 8.29474 60.555 8.19495 60.4823 8.05376C60.1601 7.42845 59.6144 7.11579 58.8453 7.11579C58.2312 7.11579 57.7413 7.34298 57.3754 7.79737C57.0096 8.23947 56.8267 8.87807 56.8267 9.71316C56.8267 10.5482 57.0096 11.193 57.3754 11.6474C57.7413 12.0895 58.2312 12.3105 58.8453 12.3105C59.6144 12.3105 60.1601 11.9979 60.4823 11.3726C60.555 11.2314 60.6944 11.1316 60.8532 11.1316H63.6709C63.9185 11.1316 64.1017 11.3635 64.0245 11.5987C63.7014 12.5824 63.1378 13.3723 62.3337 13.9684C61.4061 14.6561 60.2629 15 58.9041 15C57.8327 15 56.879 14.7851 56.0428 14.3553C55.2197 13.9254 54.5729 13.3114 54.1026 12.5132C53.6453 11.7149 53.4166 10.7816 53.4166 9.71316Z" fill="black"/>
                <path d="M75.6696 9.54737C75.6696 9.7369 75.6615 9.9315 75.6453 10.1312C75.6296 10.3241 75.4653 10.4684 75.2718 10.4684H68.4422C68.2182 10.4684 68.0387 10.6608 68.087 10.8795C68.1846 11.3219 68.38 11.6761 68.6731 11.9421C69.065 12.2737 69.5419 12.4395 70.1037 12.4395C70.8477 12.4395 71.3899 12.177 71.7305 11.6522C71.81 11.5297 71.9404 11.4447 72.0864 11.4447H74.9141C75.1664 11.4447 75.3501 11.6851 75.257 11.9197C75.0632 12.4083 74.7826 12.8578 74.4153 13.2684C73.945 13.8088 73.3505 14.2325 72.6319 14.5395C71.9133 14.8465 71.1098 15 70.2213 15C69.15 15 68.1962 14.7851 67.36 14.3553C66.5238 13.9254 65.8706 13.3114 65.4002 12.5132C64.9299 11.7149 64.6947 10.7816 64.6947 9.71316C64.6947 8.64474 64.9233 7.7114 65.3806 6.91316C65.851 6.11491 66.5042 5.50088 67.3404 5.07105C68.1766 4.64123 69.1369 4.42631 70.2213 4.42631C71.2796 4.42631 72.2203 4.63509 73.0434 5.05263C73.8666 5.47018 74.5068 6.06579 74.9641 6.83947C75.4344 7.61316 75.6696 8.51579 75.6696 9.54737ZM71.8568 8.71842C72.0684 8.71842 72.2454 8.54507 72.2039 8.33755C72.1309 7.97209 71.9469 7.66923 71.652 7.42895C71.26 7.10965 70.7701 6.95 70.1821 6.95C69.6203 6.95 69.1434 7.10351 68.7515 7.41053C68.4767 7.63317 68.2775 7.92363 68.1539 8.2819C68.0769 8.50504 68.2601 8.71842 68.4961 8.71842H71.8568Z" fill="black"/>
                <path d="M76.5752 9.82368C76.5752 8.77982 76.7973 7.87105 77.2416 7.09737C77.6858 6.3114 78.2999 5.70965 79.0838 5.2921C79.8677 4.86228 80.7627 4.64737 81.7687 4.64737C83.0883 4.64737 84.1727 4.95439 85.022 5.56842C85.7537 6.08947 86.2644 6.76969 86.5539 7.60908C86.6345 7.84262 86.4512 8.07368 86.2041 8.07368H85.5164C85.3409 8.07368 85.1903 7.95343 85.1318 7.788C84.9231 7.19899 84.5534 6.72931 84.0225 6.37895C83.4215 5.9614 82.6702 5.75263 81.7687 5.75263C81.0501 5.75263 80.4034 5.90614 79.8285 6.21316C79.2536 6.52018 78.7963 6.9807 78.4566 7.59474C78.13 8.19649 77.9667 8.93947 77.9667 9.82368C77.9667 10.7079 78.13 11.457 78.4566 12.0711C78.7963 12.6851 79.2536 13.1456 79.8285 13.4526C80.4034 13.7597 81.0501 13.9132 81.7687 13.9132C82.6702 13.9132 83.4215 13.7105 84.0225 13.3053C84.5544 12.9436 84.9245 12.4622 85.1329 11.861C85.1906 11.6946 85.3416 11.5737 85.5176 11.5737H86.2015C86.4494 11.5737 86.6328 11.8062 86.5499 12.0398C86.2596 12.8579 85.7503 13.5315 85.022 14.0605C84.1597 14.6868 83.0752 15 81.7687 15C80.7627 15 79.8677 14.7912 79.0838 14.3737C78.2999 13.9439 77.6858 13.3421 77.2416 12.5684C76.7973 11.7825 76.5752 10.8675 76.5752 9.82368Z" fill="black"/>
                <path d="M90.0054 5.12588C90.0054 5.47825 90.6241 5.66862 90.8988 5.44794C91.046 5.32969 91.2055 5.22248 91.3772 5.12632C91.9136 4.83226 92.5502 4.66393 93.2872 4.62134C93.4984 4.60914 93.6702 4.78207 93.6702 4.99369V5.5829C93.6702 5.78855 93.5035 5.95526 93.2979 5.95526C92.3049 5.95526 91.5079 6.20702 90.9069 6.71053C90.3059 7.21403 90.0054 8.05526 90.0054 9.23421V14.4695C90.0054 14.6811 89.8338 14.8526 89.6222 14.8526H89.0167C88.8051 14.8526 88.6335 14.6811 88.6335 14.4695V5.1779C88.6335 4.96629 88.8051 4.79474 89.0167 4.79474H89.6742C89.8571 4.79474 90.0054 4.943 90.0054 5.12588Z" fill="black"/>
                <path d="M104.827 9.30789C104.827 9.56784 104.823 9.79169 104.814 9.97947C104.805 10.1744 104.641 10.3211 104.446 10.3211H96.3138C96.0944 10.3211 95.9181 10.5053 95.9469 10.7227C96.0255 11.3139 96.2092 11.8309 96.4983 12.2737C96.8511 12.814 97.3149 13.2254 97.8898 13.5079C98.4646 13.7781 99.0918 13.9132 99.7712 13.9132C100.66 13.9132 101.404 13.7105 102.005 13.3053C102.535 12.9554 102.91 12.5003 103.128 11.9399C103.191 11.7804 103.338 11.6658 103.51 11.6658H104.172C104.424 11.6658 104.608 11.905 104.516 12.1394C104.215 12.9099 103.705 13.5564 102.985 14.0789C102.136 14.693 101.065 15 99.7712 15C98.7651 15 97.8636 14.7912 97.0667 14.3737C96.2697 13.9439 95.6425 13.3421 95.1852 12.5684C94.741 11.7825 94.5189 10.8675 94.5189 9.82368C94.5189 8.77982 94.741 7.86491 95.1852 7.07895C95.6295 6.29298 96.2501 5.69123 97.0471 5.27368C97.844 4.85614 98.7521 4.64737 99.7712 4.64737C100.79 4.64737 101.679 4.85614 102.437 5.27368C103.207 5.69123 103.795 6.25614 104.2 6.96842C104.618 7.66842 104.827 8.44825 104.827 9.30789ZM103.059 9.27105C103.268 9.27105 103.441 9.1032 103.427 8.89465C103.388 8.30572 103.227 7.79259 102.946 7.35526C102.619 6.82719 102.169 6.42807 101.594 6.15789C101.019 5.88772 100.392 5.75263 99.7124 5.75263C98.6933 5.75263 97.8244 6.05965 97.1058 6.67368C96.4773 7.21073 96.0937 7.94037 95.9549 8.86259C95.9219 9.08229 96.0992 9.27105 96.3214 9.27105H103.059Z" fill="black"/>
                <path d="M106.122 9.80526C106.122 8.77368 106.344 7.87105 106.789 7.09737C107.233 6.3114 107.84 5.70965 108.611 5.2921C109.395 4.86228 110.277 4.64737 111.257 4.64737C112.198 4.64737 113.047 4.86228 113.805 5.2921C114.049 5.4307 114.272 5.5827 114.475 5.74811C114.786 6.00274 115.471 5.7841 115.471 5.38191V1.60422C115.471 1.3926 115.642 1.22105 115.854 1.22105H116.459C116.671 1.22105 116.842 1.3926 116.842 1.60422V14.4695C116.842 14.6811 116.671 14.8526 116.459 14.8526H115.854C115.642 14.8526 115.471 14.6811 115.471 14.4695V14.3326C115.471 13.9226 114.728 13.6907 114.411 13.9505C114.243 14.0878 114.061 14.2166 113.864 14.3368C113.119 14.7789 112.243 15 111.237 15C110.257 15 109.376 14.7851 108.592 14.3553C107.821 13.9254 107.213 13.3175 106.769 12.5316C106.338 11.7456 106.122 10.8368 106.122 9.80526ZM115.471 9.82368C115.471 9.01316 115.294 8.30088 114.941 7.68684C114.589 7.07281 114.105 6.6 113.491 6.26842C112.89 5.93684 112.224 5.77105 111.492 5.77105C110.734 5.77105 110.055 5.9307 109.454 6.25C108.853 6.5693 108.376 7.03596 108.023 7.65C107.684 8.25175 107.514 8.97018 107.514 9.80526C107.514 10.6281 107.684 11.3526 108.023 11.9789C108.376 12.593 108.853 13.0658 109.454 13.3974C110.055 13.7167 110.734 13.8763 111.492 13.8763C112.224 13.8763 112.89 13.7105 113.491 13.3789C114.105 13.0474 114.589 12.5746 114.941 11.9605C115.294 11.3465 115.471 10.6342 115.471 9.82368Z" fill="black"/>
                <path d="M120.072 2.89737C119.798 2.89737 119.563 2.80526 119.367 2.62105C119.171 2.43684 119.073 2.20965 119.073 1.93947C119.073 1.6693 119.171 1.44825 119.367 1.27632C119.563 1.09211 119.798 1 120.072 1C120.347 1 120.582 1.09211 120.778 1.27632C120.974 1.44825 121.072 1.6693 121.072 1.93947C121.072 2.20965 120.974 2.43684 120.778 2.62105C120.582 2.80526 120.347 2.89737 120.072 2.89737ZM120.375 4.79474C120.587 4.79474 120.758 4.96629 120.758 5.1779V14.4695C120.758 14.6811 120.587 14.8526 120.375 14.8526H119.77C119.558 14.8526 119.386 14.6811 119.386 14.4695V5.1779C119.386 4.96629 119.558 4.79474 119.77 4.79474H120.375Z" fill="black"/>
                <path d="M125.443 5.88158C125.232 5.88158 125.06 6.05313 125.06 6.26474V12.1263C125.06 12.7404 125.184 13.164 125.433 13.3974C125.681 13.6307 126.119 13.7474 126.746 13.7474H127.617C127.828 13.7474 128 13.9189 128 14.1305V14.4695C128 14.6811 127.828 14.8526 127.617 14.8526H126.53C125.563 14.8526 124.845 14.6439 124.374 14.2263C123.904 13.7965 123.669 13.0965 123.669 12.1263V6.26474C123.669 6.05313 123.497 5.88158 123.286 5.88158H122.563C122.351 5.88158 122.179 5.71003 122.179 5.49841V5.1779C122.179 4.96629 122.351 4.79474 122.563 4.79474H123.286C123.497 4.79474 123.669 4.62319 123.669 4.41157V2.65422C123.669 2.4426 123.84 2.27105 124.052 2.27105H124.677C124.889 2.27105 125.06 2.4426 125.06 2.65422V4.41157C125.06 4.62319 125.232 4.79474 125.443 4.79474H127.617C127.828 4.79474 128 4.96629 128 5.1779V5.49841C128 5.71003 127.828 5.88158 127.617 5.88158H125.443Z" fill="black"/>
            </svg>
        </div>
        <div class="py-6 md:py-20 min-h-screen flex items-center justify-center">
            <div v-if="activeLoan" class="flex md:gap-[25px] w-full">
                <div class="w-full md:basis-2/4">
                    <div class="flex flex-col gap-4">
                        <div class="rounded-xl bg-white border border-solid border-lance-black-10 py-6 px-4 md:px-10">
                            <p class="text-lance-black-50 text-sm leading-5">Next Repayment</p>
                            <p class="mt-[-12px] text-lance-black text-[28px] md:text-4xl font-bold leading-[52px] md:leading-[55.93px] tracking-[0.28px] md:tracking-[0.36px]">
                                {{ activeLoan ? (activeLoan.schedule).find((schedule) => schedule.status != 'paid')?.remainingAmount.toLocaleString() : '' }}
                            </p>
                            <p class="mb-3 flex gap-1.5 items-center">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.7777 6.60303H1.89499C1.61899 6.60303 1.39499 6.37903 1.39499 6.10303C1.39499 5.82703 1.61899 5.60303 1.89499 5.60303H13.7777C14.0537 5.60303 14.2777 5.82703 14.2777 6.10303C14.2777 6.37903 14.0537 6.60303 13.7777 6.60303Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.8008 9.20654C10.5248 9.20654 10.2981 8.98254 10.2981 8.70654C10.2981 8.43054 10.5188 8.20654 10.7948 8.20654H10.8008C11.0768 8.20654 11.3008 8.43054 11.3008 8.70654C11.3008 8.98254 11.0768 9.20654 10.8008 9.20654Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84248 9.20654C7.56648 9.20654 7.33981 8.98254 7.33981 8.70654C7.33981 8.43054 7.56048 8.20654 7.83648 8.20654H7.84248C8.11848 8.20654 8.34248 8.43054 8.34248 8.70654C8.34248 8.98254 8.11848 9.20654 7.84248 9.20654Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.87794 9.20654C4.60194 9.20654 4.3746 8.98254 4.3746 8.70654C4.3746 8.43054 4.59594 8.20654 4.87194 8.20654H4.87794C5.15394 8.20654 5.37794 8.43054 5.37794 8.70654C5.37794 8.98254 5.15394 9.20654 4.87794 9.20654Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.8008 11.7976C10.5248 11.7976 10.2981 11.5736 10.2981 11.2976C10.2981 11.0216 10.5188 10.7976 10.7948 10.7976H10.8008C11.0768 10.7976 11.3008 11.0216 11.3008 11.2976C11.3008 11.5736 11.0768 11.7976 10.8008 11.7976Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84248 11.7976C7.56648 11.7976 7.33981 11.5736 7.33981 11.2976C7.33981 11.0216 7.56048 10.7976 7.83648 10.7976H7.84248C8.11848 10.7976 8.34248 11.0216 8.34248 11.2976C8.34248 11.5736 8.11848 11.7976 7.84248 11.7976Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.87794 11.7976C4.60194 11.7976 4.3746 11.5736 4.3746 11.2976C4.3746 11.0216 4.59594 10.7976 4.87194 10.7976H4.87794C5.15394 10.7976 5.37794 11.0216 5.37794 11.2976C5.37794 11.5736 5.15394 11.7976 4.87794 11.7976Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.529 3.86075C10.253 3.86075 10.029 3.63675 10.029 3.36075V1.16675C10.029 0.890748 10.253 0.666748 10.529 0.666748C10.805 0.666748 11.029 0.890748 11.029 1.16675V3.36075C11.029 3.63675 10.805 3.86075 10.529 3.86075Z" fill="#041111" fill-opacity="0.6"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.14352 3.86075C4.86752 3.86075 4.64352 3.63675 4.64352 3.36075V1.16675C4.64352 0.890748 4.86752 0.666748 5.14352 0.666748C5.41952 0.666748 5.64352 0.890748 5.64352 1.16675V3.36075C5.64352 3.63675 5.41952 3.86075 5.14352 3.86075Z" fill="#041111" fill-opacity="0.6"/>
                                    <mask id="mask0_3121_12704" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="1" y="1" width="14" height="15">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.33334 1.71948H14.3333V15.0001H1.33334V1.71948Z" fill="white"/>
                                    </mask>
                                    <g mask="url(#mask0_3121_12704)">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.014 2.71965C3.28533 2.71965 2.33333 3.64165 2.33333 5.31565V11.3483C2.33333 13.059 3.28533 14.0003 5.014 14.0003H10.6527C12.3813 14.0003 13.3333 13.0763 13.3333 11.399V5.31565C13.336 4.49231 13.1147 3.85231 12.6753 3.41231C12.2233 2.95898 11.5267 2.71965 10.6587 2.71965H5.014ZM10.6527 15.0001H5.01401C2.74401 15.0001 1.33334 13.6008 1.33334 11.3481V5.31548C1.33334 3.09682 2.74401 1.71948 5.01401 1.71948H10.6587C11.798 1.71948 12.74 2.06082 13.3833 2.70548C14.008 3.33282 14.3367 4.23482 14.3333 5.31682V11.3988C14.3333 13.6201 12.9227 15.0001 10.6527 15.0001Z" fill="#041111" fill-opacity="0.6"/>
                                    </g>
                                </svg>
                                <span class="text-lance-black text-sm leading-5">
                                    Due: {{ nextRepaymentDate }}
                                </span>
                            </p>
                            <div class="mb-3 rounded-lg bg-lance-green-5 py-2 px-4">
                                <div class="flex items-center justify-between mb-1 text-lance-black-60 text-sm leading-5">
                                    <p>Paid: <span class="font-semibold">N {{ activeLoanTotalPaid.toLocaleString() }}</span></p>
                                    <p>
                                        Balance : <span class="font-semibold">N {{ activeLoan ? (activeLoan.totalRepaymentAmount - activeLoanTotalPaid).toLocaleString() : '' }}</span>
                                    </p>
                                </div>
                                <div class="h-2 w-full rounded-lg bg-lance-green-10" style="box-shadow: 0px 1px 4px 0px rgba(0, 0, 0, 0.10) inset;">
                                    <div class="h-full rounded-lg" :style="`width: ${percentageLoanPaid}%`" style="background: linear-gradient(90deg, #E8FF28 -2.03%, #09837F 101.29%);"></div>
                                </div>
                            </div>
                            <div class="border-t border-solid border-lance-black-5 pt-4 flex gap-[7px] md:gap-6">
                                <button @click="showLoanRepaymentModal = true" class="btn btn-primary w-full">Make a Repayment</button>
                            </div>
                        </div>
                        <div class="rounded-xl bg-white border border-solid border-lance-black-10 py-[30px] px-3 md:p-10">
                            <p class="mb-2 text-[#1E1721] font-aventa text-sm md:text-base leading-[18px] md:leading-8 tracking-[-0.14px] md:tracking-[-0.16px] font-bold">
                                Repayment Timeline
                            </p>
                            <div class="md:h-[275px] overflow-y-scroll md:overflow-y-hidden flex gap-4">
                                <div v-if="activeLoan" class="px-[2.335px] pt-[6.33px] flex flex-col items-center">
                                    <div v-for="(repayment, key) in activeLoan.schedule" :key="key" class="flex flex-col items-center">
                                        <div class="w-0.5 h-[48.66px] bg-[#063A4F] opacity-10" v-if="key != 0"></div>
                                        <div
                                            class="w-[23.333px] h-[23.333px] rounded-full border-[1.75px] border-solid flex items-center justify-center"
                                            :class="[{ 'bg-[#ECFF4D]' : repayment.status === 'paid' }, repayment.status === 'paid' || Date.now() > new Date(repayment.dueDate).getTime() ? 'border-lance-green' : 'border-lance-green-30']"
                                        >
                                            <svg v-if="repayment.status === 'paid'" xmlns="http://www.w3.org/2000/svg" width="11" height="8" viewBox="0 0 11 8" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.28231 7.31015C4.05948 7.31015 3.83431 7.22498 3.66398 7.05348L0.894314 4.28498C0.552481 3.94315 0.552481 3.39015 0.894314 3.04831C1.23615 2.70648 1.78915 2.70648 2.13098 3.04831L4.28231 5.19731L9.20098 0.279813C9.54282 -0.0620209 10.0958 -0.0620209 10.4376 0.279813C10.7795 0.621646 10.7795 1.17465 10.4376 1.51648L4.90065 7.05348C4.73031 7.22498 4.50631 7.31015 4.28231 7.31015Z" fill="#0A4F4D"/>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <ul v-if="activeLoan" class="flex flex-col gap-8 grow">
                                    <li v-for="(repayment, key) in activeLoan.schedule" :key="key" class="flex items-center justify-between">
                                        <div class="text-lance-black">
                                            <p class="leading-[22.4px] font-semibold">
                                                {{ repayment.status == 'paid' ? (repayment.paidAmount).toLocaleString() : (repayment.remainingAmount).toLocaleString() }}
                                            </p>
                                            <p v-if="repayment.status === 'paid'" class="text-xs leading-[16.8px]">
                                                Date Paid:
                                                <span class="font-semibold">
                                                    {{ repayment.status === 'paid' ? new Date(repayment.paidAt).toLocaleDateString('en-GB', { day:"numeric", month:"short", year:"numeric" }) : '' }}
                                                </span>
                                            </p>
                                            <p v-else class="text-xs leading-[16.8px]">
                                                Date Due:
                                                <span class="font-semibold">
                                                    {{ new Date(repayment.dueDate).toLocaleDateString('en-GB', { day:"numeric", month:"short", year:"numeric" }) }}
                                                </span>
                                            </p>
                                        </div>
                                        <p v-if="repayment.status === 'paid'" class="w-[81px] h-8 rounded-[31px] bg-[rgba(12,180,59,0.04)] flex items-center justify-center py-1">
                                            <span class="text-[#0CB43B] text-sm font-medium">Paid</span>
                                        </p>
                                        <div v-else>
                                            <div v-if="Date.now() < new Date(repayment.dueDate).getTime()" class="w-[81px] py-1 text-center rounded-[31px] bg-lance-black-5 text-lance-black-50 text-sm font-medium leading-6">
                                                Upcoming
                                            </div>
                                            <div v-else class="w-[81px] py-1 text-center rounded-[31px] border border-solid border-[#E70A3F] bg-[rgba(231,10,63,0.05)] text-[#E70A3F] text-sm font-medium leading-6">
                                                Due
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    class="rounded-xl bg-white border border-solid border-lance-black-10 py-[35px] px-4 md:p-10 w-full md:basis-2/4 hidden md:block"
                >
                    <div class="flex items-center justify-center">
                        <div class="bg-white w-full sm:w-[466px] h-full sm:h-auto sm:rounded-3xl px-6 py-10 sm:p-10 flex flex-col gap-6">
                            <p class="text-lance-black text-base sm:text-2xl font-bold sm:font-medium sm:leading-[26px] tracking-[-0.24px] flex items-center">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="sm:hidden">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.3332 17.5C13.1199 17.5 12.9065 17.4183 12.744 17.2558L6.07738 10.5892C5.75155 10.2633 5.75155 9.73666 6.07738 9.41083L12.744 2.74416C13.0699 2.41833 13.5965 2.41833 13.9224 2.74416C14.2482 3.06999 14.2482 3.59666 13.9224 3.92249L7.84488 9.99999L13.9224 16.0775C14.2482 16.4033 14.2482 16.93 13.9224 17.2558C13.7599 17.4183 13.5465 17.5 13.3332 17.5" fill="#0A4F4D"/>
                                </svg>
                                <span class="mx-auto sm:mx-0">Loan Details</span>
                            </p>
                            <div>
                                <p v-show="loanReferenceCopied" class="mb-2 py-2 px-4 text-center text-[#272E2E] text-sm leading-6 rounded-[4px] border border-solid border-[#DAE0E0] bg-[#FAFCFC]">
                                    Copied to clipboard
                                </p>
                                <ul class="p-6 rounded-lg border border-solid border-lance-black bg-[rgba(236,255,77,0.05)]">
                                    <li class="flex items-center justify-between pb-4 border-b border-solid border-b-lance-green-5">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Loan Amount</p>
                                        <p class="text-lance-black text-[13px] sm:text-base leading-6">N{{ (activeLoan?.amount)?.toLocaleString() }}</p>
                                    </li>
                                    <li class="flex items-center justify-between py-4 border-b border-solid border-b-lance-green-5">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Reference</p>
                                        <p class="text-lance-black text-[13px] sm:text-base leading-6 flex items-center gap-2">
                                            <span class="">{{ activeLoan?.reference }}</span>
                                            <svg @click="copyReferenceCode" class="cursor-pointer" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <mask id="mask0_3427_18542" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="1" width="15" height="18">
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M2.74731 1.67627H16.9579V18.2209H2.74731V1.67627Z" fill="white"/>
                                                </mask>
                                                <g mask="url(#mask0_3427_18542)">
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M6.29545 4.36198C5.104 4.36198 4.1146 5.35489 4.08655 6.57939V14.4924C4.05995 15.7598 5.03065 16.8037 6.25015 16.8319H12.0485C13.2486 16.7808 14.1991 15.7546 14.1905 14.4968V7.9341L10.8578 4.36198H6.30407H6.29545ZM6.3042 17.9415H6.22582C4.4124 17.8993 2.96857 16.347 3.00812 14.4803V6.56586C3.04982 4.73023 4.52314 3.25195 6.29413 3.25195H6.30636H11.088C11.2347 3.25195 11.3749 3.31336 11.477 3.42212L15.1189 7.32645C15.2153 7.4293 15.2692 7.56765 15.2692 7.71045V14.4922C15.2821 16.3485 13.8771 17.8653 12.0702 17.9407L6.3042 17.9415Z" fill="#AEB2B2"/>
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M6.55823 2.9165C5.1774 2.9165 4.03073 4.03484 3.99823 5.414V14.3265C3.9674 15.754 5.0924 16.9298 6.50573 16.9615H13.2257C14.6166 16.904 15.7182 15.7482 15.7082 14.3315V6.93984L11.8457 2.9165H6.56823H6.55823ZM6.56823 18.2115H6.4774C4.37573 18.164 2.7024 16.4157 2.74823 14.3132V5.399C2.79657 3.3315 4.50407 1.6665 6.55657 1.6665H6.57073H12.1124C12.2824 1.6665 12.4449 1.73567 12.5632 1.85817L16.7841 6.25567C16.8957 6.3715 16.9582 6.52734 16.9582 6.68817V14.3265C16.9732 16.4173 15.3449 18.1257 13.2507 18.2107L6.56823 18.2115Z" fill="#AEB2B2"/>
                                                </g>
                                            </svg>
                                        </p>
                                    </li>
                                    <li class="flex items-center justify-between py-4 border-b border-solid border-b-lance-green-5">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Interest Rate</p>
                                        <p class="text-lance-black text-[13px] sm:text-base leading-6">{{ activeLoan?.rate }}% per month</p>
                                    </li>
                                    <li class="flex items-center justify-between py-4 border-b border-solid border-b-lance-green-5">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Duration</p>
                                        <p class="text-lance-black text-[13px] sm:text-base leading-6">{{ activeLoan?.tenure }} months</p>
                                    </li>
                                    <li class="flex items-center justify-between py-4 border-b border-solid border-b-lance-green-5">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Monthly Repayment</p>
                                        <p class="text-lance-black text-[13px] sm:text-base leading-6">N{{ (activeLoan?.monthlyRepaymentAmount)?.toLocaleString() }} every month</p>
                                    </li>
                                </ul>
                                <div class="mt-4 p-6 rounded-lg border border-solid border-lance-black bg-[rgba(236,255,77,0.05)]">
                                    <div class="flex items-center justify-between">
                                        <p class="text-lance-black-70 text-xs sm:text-sm leading-[18px] sm:leading-[21px]">Total Repayment</p>
                                        <p class="text-lance-green text-2xl font-bold leading-[30px]">
                                            N{{ (activeLoan?.totalRepaymentAmount)?.toLocaleString() }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-else class="h-full flex flex-col items-center text-center justify-center gap-6 sm:w-[376px] mx-auto">
                <div class="w-[192px] h-[192px] rounded-full bg-[#D6F0AD] flex items-center justify-center mx-auto">
                    <img src="/assets/img/wallet.svg" alt="">
                </div>
                <div v-if="!fetchingLinkInfo">
                    <p class="mb-4 text-lance-black text-lg sm:text-xl font-medium leading-[26px] tracking-[-0.18px] sm:tracking-[-0.2px]">
                        Invalid or Inactive Link
                    </p>
                    <p class="text-lance-black-60 text-sm sm:text-base leading-[18px] sm:leading-6">
                        This link is either invalid or inactive.
                    </p>
                </div>
                <div v-else>
                    <p class="text-lance-black-60 text-sm sm:text-base leading-[18px] sm:leading-6">
                        Fetching Link Details...
                    </p>
                </div>
                <a href="/" class="btn btn-primary w-full sm:w-[282px]">Go back home</a>
            </div>
    
            <Loans-LinkRepaymentModal
                @@close-loan-repayment-modal="showLoanRepaymentModal = false"
                @@successful-loan-repayment="loanRepaymentSuccessful"
                v-show="showLoanRepaymentModal" :loan="activeLoan" :token="token" :activeLoanTotalPaid="activeLoanTotalPaid"
            />
        </div>
    </div>
</template>

<script setup lang="ts">

    const { apiFetch } = useApiFetch();

    const activeLoan: Ref<Loan | null> = ref(null);
    const nextRepaymentDate = computed(() => {
        if(activeLoan.value){
            const nextRepayment = activeLoan.value.schedule.find((schedule) => schedule.status != 'paid');
            if(nextRepayment){
                return new Date(nextRepayment.dueDate).toLocaleDateString('en-GB', { day:"numeric", month:"short", year:"numeric" });
            }
        }
        return '- -';
    });

    const activeLoanTotalPaid = computed(() => {
            return activeLoan.value
                ? (activeLoan.value.schedule).reduce((total, repayment): number => {
                    return total + repayment.paidAmount;
                }, 0)
                : 0;
        });
    const percentageLoanPaid = computed(() => {
        const loan: Loan | null | undefined = activeLoan.value;
        if(loan){
            return (activeLoanTotalPaid.value / loan.totalRepaymentAmount) * 100;
        }
        return 100;
    });
        

    const fetchingLinkInfo: Ref<boolean> = ref(true);

    const token: Ref<string> = ref('');

    onMounted(async()=>{

        const route = useRoute();
        const code = route.params.code as string;

        retrieveLinkInfo(code);

    });

    const showLoanRepaymentModal: Ref<boolean> = ref(false);
    
    async function loanRepaymentSuccessful(){
        showLoanRepaymentModal.value = false;
    }

    async function retrieveLinkInfo(code: string) {
        fetchingLinkInfo.value = true;

        const result = await apiFetch(`repayment-links/${code}`);

        fetchingLinkInfo.value = false;
        
        if ((result as any).success && !(result as any).error) {
            if((result as any).data.status.toLowerCase() == 'active'){
                (result as any).data.loan.amount = (result as any).data.loan.amount / 100;
                (result as any).data.loan.monthlyRepaymentAmount = (result as any).data.loan.monthlyRepaymentAmount / 100;
                (result as any).data.loan.totalInterestAmount = (result as any).data.loan.totalInterestAmount / 100;
                (result as any).data.loan.totalRepaymentAmount = (result as any).data.loan.totalRepaymentAmount / 100;

                const schedules = (result as any).data.loan.schedule.map((schedule: LoanSchedule) => {
                    schedule.amount = schedule.amount / 100;
                    schedule.paidAmount = schedule.paidAmount / 100;
                    schedule.remainingAmount = schedule.remainingAmount / 100;
                    return schedule;
                });
                (result as any).data.loan.schedule = schedules;
                
                activeLoan.value = (result as any).data.loan
                token.value = (result as any).data.session.token
            }
        }
    }

    function copyReferenceCode(){
        showLoanReferenceCopied();
        navigator.clipboard.writeText(activeLoan.value?.reference as string);
    }

    const loanReferenceCopied:Ref <boolean> = ref(false);

    function showLoanReferenceCopied() {
        loanReferenceCopied.value = true;
        setTimeout(()=> loanReferenceCopied.value = false, 5000);
    }

</script>